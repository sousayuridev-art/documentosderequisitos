<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Interativo - Farmácia Delirium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Slate Gray & Sky Blue -->
    <!-- Application Structure Plan: A dashboard-style SPA with a central, interactive flowchart representing the customer journey. A primary navigation bar allows users to toggle different "view layers" on top of this flowchart: a general overview, specific business rules, system integrations, and data points (Pipedrive fields/AI messages). This structure was chosen to deconstruct a dense technical document into manageable, thematic layers, allowing a user to understand the process from multiple perspectives (operational, technical, data) and see how they interrelate, which is more intuitive than reading a linear document. -->
    <!-- Visualization & Content Choices: 
        - Process Flow: Goal: Organize. Method: Interactive flowchart built with HTML divs and Tailwind CSS. Interaction: Clicking a stage reveals a modal with detailed info. Justification: Visually maps the core process described in the report in an accessible way without SVG/Mermaid.
        - Business Rules: Goal: Inform. Method: Highlightable callout boxes attached to flowchart stages. Interaction: Toggled via main navigation, adds emphasis to relevant stages. Justification: Contextualizes abstract rules directly within the process flow where they apply.
        - Integrations: Goal: Relationships. Method: A simplified diagram showing system connections. Interaction: Toggled view. Justification: Clarifies the technical backbone of the solution in a simple visual format.
        - Data & Messages: Goal: Inform. Method: Detailed content within modals, triggered by clicking flowchart stages. Justification: Provides granular information on-demand without cluttering the main view.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
        }
        .nav-btn {
            transition: all 0.2s ease-in-out;
        }
        .nav-btn.active {
            background-color: #0284c7; /* sky-600 */
            color: white;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        }
        .flow-step {
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .flow-step:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .connector {
            position: absolute;
            width: 2px;
            background-color: #94a3b8; /* slate-400 */
            z-index: 0;
        }
        .connector.down-arrow::after {
            content: '';
            position: absolute;
            left: -5px;
            bottom: -1px;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 8px solid #94a3b8;
        }
        .highlight-rule {
            box-shadow: 0 0 0 3px #fbbf24; /* amber-400 */
        }
        .highlight-integration {
            box-shadow: 0 0 0 3px #38bdf8; /* sky-400 */
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body class="text-slate-800">

    <div id="app" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">Painel Interativo de Automação</h1>
            <p class="text-lg text-slate-600 mt-2">Farmácia de Manipulação Delirium</p>
        </header>

        <nav class="bg-white rounded-lg shadow-sm p-2 mb-8 flex flex-wrap justify-center gap-2">
            <button data-view="overview" class="nav-btn active px-4 py-2 text-sm font-semibold text-slate-700 rounded-md hover:bg-slate-200">Visão Geral</button>
            <button data-view="rules" class="nav-btn px-4 py-2 text-sm font-semibold text-slate-700 rounded-md hover:bg-slate-200">Regras de Negócio</button>
            <button data-view="integrations" class="nav-btn px-4 py-2 text-sm font-semibold text-slate-700 rounded-md hover:bg-slate-200">Integrações</button>
            <button data-view="data" class="nav-btn px-4 py-2 text-sm font-semibold text-slate-700 rounded-md hover:bg-slate-200">Dados & Mensagens</button>
        </nav>

        <main id="main-content" class="relative">
            <p id="view-description" class="text-center text-slate-600 mb-8 max-w-3xl mx-auto">Explore o fluxo completo de atendimento ao cliente, desde o primeiro contato até a venda finalizada. Clique em qualquer etapa para ver mais detalhes.</p>
            
            <div class="relative grid grid-cols-1 md:grid-cols-3 gap-y-20 gap-x-8 items-start">
                
                <!-- Connectors -->
                <div class="connector down-arrow" style="top: 100%; left: 50%; height: 5rem; transform: translateX(-1px);"></div>
                <div class="md:hidden connector down-arrow" style="top: calc(33.33% + 40px); left: 50%; height: 5rem; transform: translateX(-1px);"></div>
                <div class="md:hidden connector down-arrow" style="top: calc(66.66% + 80px); left: 50%; height: 5rem; transform: translateX(-1px);"></div>
                
                <div class="hidden md:block connector" style="top: 50%; left: 33.33%; width: 33.33%; height: 2px;"></div>
                <div class="hidden md:block connector" style="top: 50%; left: 66.66%; width: 33.33%; height: 2px;"></div>
                <div class="hidden md:block connector down-arrow" style="top: 50%; right: -4rem; height: 16rem; transform: translateX(1px); border-radius: 0 20px 20px 0; border-right: 2px solid #94a3b8; border-top: 2px solid #94a3b8; border-bottom: 2px solid #94a3b8; background: none;"></div>
                <div class="hidden md:block connector" style="bottom: -5rem; left: 33.33%; width: 33.33%; height: 2px;"></div>

                <!-- Step 1: Captação -->
                <div class="col-span-1 md:col-span-3">
                    <div id="step-captacao" data-step="captacao" class="flow-step bg-white rounded-lg shadow-md p-6 border-t-4 border-sky-500 max-w-xl mx-auto">
                        <h3 class="text-xl font-bold text-center text-slate-800">1. Captação e Triagem (IA)</h3>
                        <p class="text-center text-sm text-slate-500 mt-1">Instagram, Anúncios → WhatsApp</p>
                        <div data-rule="cliente-quente" class="hidden absolute -top-4 -right-4 bg-amber-400 text-amber-900 text-xs font-bold px-2 py-1 rounded-full shadow-lg">Cliente Quente</div>
                        <div data-integration="chatguru-pipedrive" class="hidden absolute -top-4 -left-4 bg-sky-400 text-sky-900 text-xs font-bold px-2 py-1 rounded-full shadow-lg">ChatGuru → Pipedrive</div>
                    </div>
                </div>

                <!-- Step 2: Cotação -->
                <div id="step-cotacao" data-step="cotacao" class="flow-step bg-white rounded-lg shadow-md p-6 border-t-4 border-sky-500">
                    <h3 class="text-xl font-bold text-center text-slate-800">2. Cotação</h3>
                    <p class="text-center text-sm text-slate-500 mt-1">Farmacêuticos</p>
                    <div data-rule="rodizio" class="hidden absolute -top-4 -right-4 bg-amber-400 text-amber-900 text-xs font-bold px-2 py-1 rounded-full shadow-lg">Rodízio A/B/C</div>
                </div>
                
                <!-- Step 3: Negociação -->
                <div id="step-negociacao" data-step="negociacao" class="flow-step bg-white rounded-lg shadow-md p-6 border-t-4 border-sky-500">
                    <h3 class="text-xl font-bold text-center text-slate-800">3. Negociação</h3>
                    <p class="text-center text-sm text-slate-500 mt-1">Vendedor</p>
                </div>
                
                <!-- Step 4: Faturamento -->
                <div id="step-faturamento" data-step="faturamento" class="flow-step bg-white rounded-lg shadow-md p-6 border-t-4 border-sky-500">
                    <h3 class="text-xl font-bold text-center text-slate-800">4. Faturamento</h3>
                    <p class="text-center text-sm text-slate-500 mt-1">Financeiro</p>
                    <div data-rule="fallback" class="hidden absolute -top-4 -right-4 bg-amber-400 text-amber-900 text-xs font-bold px-2 py-1 rounded-full shadow-lg">Fallback</div>
                </div>

                <!-- Step 5: Finalização -->
                <div class="col-span-1 md:col-span-3 mt-12">
                    <div id="step-finalizacao" data-step="finalizacao" class="flow-step bg-white rounded-lg shadow-md p-6 border-t-4 border-green-500 max-w-xl mx-auto">
                        <h3 class="text-xl font-bold text-center text-slate-800">5. Venda Ganha</h3>
                        <p class="text-center text-sm text-slate-500 mt-1">Produção Iniciada</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal -->
    <div id="modal" class="hidden fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div id="modal-backdrop" class="fixed inset-0 modal-backdrop transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-bold text-gray-900" id="modal-title">Detalhes da Etapa</h3>
                            <div class="mt-4" id="modal-content">
                                <!-- Dynamic Content Here -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="modal-close-btn" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const state = {
                currentView: 'overview'
            };

            const contentData = {
                captacao: {
                    title: '1. Captação e Triagem (IA)',
                    description: 'O processo começa quando um cliente entra em contato pelo WhatsApp. A IA assume o primeiro atendimento para qualificar o lead.',
                    messages: [
                        '**Pedir Receita/Dados:** "Olá! Sou o assistente virtual da Delirium. Para começarmos seu orçamento, por favor, me envie seu Nome Completo e CPF. Em seguida, é só enviar a foto da sua receita, o arquivo PDF ou colar os compostos aqui."',
                        '**Confirmação Envio:** "Perfeito, recebi tudo! Já organizei suas informações e estou encaminhando para um de nossos farmacêuticos. Em breve um vendedor retornará com sua cotação completa. 👍"'
                    ],
                    pipedrive: [
                        '`origem_lead` (Preenchido: Instagram Bio, etc.)',
                        '`responsavel_atual` (Definido para a IA/Vendedor)',
                        '**Status:** Novo Negócio Criado no Funil'
                    ],
                    integrations: [
                        '**ChatGuru → Pipedrive (API):** A IA cria um novo "Negócio" no Pipedrive com os dados coletados do cliente.',
                        '**API Key:** `CHATGURU_API_KEY=MOCK_123`',
                        '**API Token:** `PIPEDRIVE_API_TOKEN=MOCK_ABC`'
                    ],
                    rules: [
                        '**Cliente Quente:** Se o lead envia Nome, CPF e receita em menos de 3 minutos, ele é marcado com a etiqueta #clientequente e uma atividade prioritária é criada no Pipedrive.'
                    ]
                },
                cotacao: {
                    title: '2. Cotação (Farmacêutico)',
                    description: 'A IA transfere a conversa para um farmacêutico disponível, que analisa os compostos e define o preço.',
                    messages: [
                        '**Resumo para Farmacêutico:** `--- RESUMO PARA COTAÇÃO --- Cliente: [Nome] | Compostos: [Texto extraído] | Link Pipedrive: [Link]`'
                    ],
                    pipedrive: [
                        '`valor_original` (Preenchido pelo farmacêutico)',
                        '**Status:** Movido para "Aguardando Cotação"'
                    ],
                    rules: [
                        '**Rodízio de Farmacêuticos:** A plataforma distribui as conversas de forma sequencial (A → B → C) para garantir uma carga de trabalho equilibrada.'
                    ]
                },
                negociacao: {
                    title: '3. Negociação (Vendedor)',
                    description: 'O vendedor recebe a cotação e assume a conversa para negociar com o cliente, aplicar descontos e fechar a venda.',
                    messages: [
                        '**Lembrete de Retomada (24h):** "Olá, [Nome do Cliente]! Passando para saber se você conseguiu dar uma olhadinha na proposta que te enviamos. Ficou alguma dúvida?"'
                    ],
                    pipedrive: [
                        '`desconto_aplicado` (Preenchido se houver)',
                        '`valor_final` (Campo calculado)',
                        '**Status:** Movido para "Proposta Enviada" / "Em Negociação"'
                    ]
                },
                faturamento: {
                    title: '4. Faturamento (Financeiro)',
                    description: 'Após o acordo, a conversa é transferida para o financeiro, que gera o pagamento e acompanha a confirmação.',
                    messages: [
                        '**Resumo para Financeiro:** `--- RESUMO PARA FATURAMENTO --- Cliente: [Nome] | Valor Final: R$ [Valor] | Forma de Pagamento: [Condição] | Link Pipedrive: [Link]`'
                    ],
                    pipedrive: [
                        '**Status:** Movido para "Aguardando Pagamento"'
                    ],
                    rules: [
                        '**Exceção do Financeiro (Fallback):** Se o responsável principal estiver offline, a conversa é automaticamente enviada para o auxiliar financeiro para não haver atrasos.'
                    ]
                },
                finalizacao: {
                    title: '5. Venda Ganha',
                    description: 'Com o pagamento confirmado, a venda é marcada como "Ganha" e o pedido segue para a produção.',
                    pipedrive: [
                        '**Status:** Movido para "Ganha"'
                    ]
                }
            };
            
            const navButtons = document.querySelectorAll('.nav-btn');
            const viewDescription = document.getElementById('view-description');
            const flowSteps = document.querySelectorAll('.flow-step');
            
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modal-title');
            const modalContent = document.getElementById('modal-content');
            
            function updateView() {
                // Update nav buttons
                navButtons.forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.view === state.currentView);
                });

                // Reset all highlights
                document.querySelectorAll('[data-rule], [data-integration]').forEach(el => el.classList.add('hidden'));
                flowSteps.forEach(step => {
                    step.classList.remove('highlight-rule', 'highlight-integration');
                });
                
                switch (state.currentView) {
                    case 'overview':
                        viewDescription.textContent = 'Explore o fluxo completo de atendimento ao cliente, desde o primeiro contato até a venda finalizada. Clique em qualquer etapa para ver mais detalhes.';
                        break;
                    case 'rules':
                        viewDescription.textContent = 'Estas são as regras de negócio que governam a automação. As etapas onde regras específicas são aplicadas estão destacadas em amarelo.';
                        document.querySelectorAll('[data-rule]').forEach(el => el.classList.remove('hidden'));
                        document.querySelectorAll('[data-rule]').forEach(el => el.closest('.flow-step').classList.add('highlight-rule'));
                        break;
                    case 'integrations':
                        viewDescription.textContent = 'Veja como os sistemas (ChatGuru e Pipedrive) se comunicam. As etapas que envolvem troca de dados estão destacadas em azul.';
                        document.querySelectorAll('[data-integration]').forEach(el => el.classList.remove('hidden'));
                        document.querySelectorAll('[data-integration]').forEach(el => el.closest('.flow-step').classList.add('highlight-integration'));
                        break;
                    case 'data':
                        viewDescription.textContent = 'Clique em uma etapa para ver os campos do Pipedrive que são atualizados e os modelos de mensagens da IA utilizados naquele momento.';
                        break;
                }
            }

            function formatContent(contentArray) {
                if (!contentArray || contentArray.length === 0) return '';
                return `<ul>${contentArray.map(item => `<li class="mt-2 text-sm text-slate-600">${item.replace(/`([^`]+)`/g, '<code class="bg-slate-200 text-slate-800 px-1 rounded text-xs">$&</code>').replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')}</li>`).join('')}</ul>`;
            }

            function openModal(stepId) {
                const data = contentData[stepId];
                if (!data) return;

                modalTitle.textContent = data.title;
                
                let contentHTML = `<p class="text-sm text-slate-700">${data.description || ''}</p>`;

                if (data.messages) {
                    contentHTML += `<h4 class="font-semibold text-slate-800 mt-4">Mensagens-Chave da IA:</h4>${formatContent(data.messages)}`;
                }
                if (data.pipedrive) {
                    contentHTML += `<h4 class="font-semibold text-slate-800 mt-4">Atualizações no Pipedrive:</h4>${formatContent(data.pipedrive)}`;
                }
                if (data.integrations) {
                     contentHTML += `<h4 class="font-semibold text-slate-800 mt-4">Detalhes da Integração:</h4>${formatContent(data.integrations)}`;
                }
                if (data.rules) {
                     contentHTML += `<h4 class="font-semibold text-slate-800 mt-4">Regras de Negócio Aplicadas:</h4>${formatContent(data.rules)}`;
                }
                
                modalContent.innerHTML = contentHTML;
                modal.classList.remove('hidden');
            }

            function closeModal() {
                modal.classList.add('hidden');
            }

            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    state.currentView = button.dataset.view;
                    updateView();
                });
            });

            flowSteps.forEach(step => {
                step.addEventListener('click', () => {
                    openModal(step.dataset.step);
                });
            });

            document.getElementById('modal-close-btn').addEventListener('click', closeModal);
            document.getElementById('modal-backdrop').addEventListener('click', closeModal);

            // Initial render
            updateView();
        });
    </script>

</body>
</html>
